test_that("FDate arith", {
	expect_equal(as.FDate("2000-2-28") + as.ddur("P0"), as.FDate(20000228L))
	expect_equal(as.FDate("2000-2-28") + as.ddur("P1D"), as.FDate(20000229L))
	expect_equal(as.FDate("2000-2-28") + as.ddur("P1W"), as.FDate("2000-03-06"))
	expect_equal(as.FDate("2000-2-28") + as.ddur("P-1D"), as.FDate("2000-02-27"))
	expect_equal(as.FDate("2000-2-28") + as.ddur("P-2W"), as.FDate("2000-02-14"))

	expect_equal(as.FDate("2000-2-29") + as.ddur("P1M"), as.FDate("2000-03-29"))
	expect_equal(as.FDate("2000-2-29") + as.ddur("P-1M"), as.FDate("2000-01-29"))
	expect_equal(as.FDate("2000-2-29") + as.ddur("P-13M"), as.FDate(19990129L))
	expect_equal(as.FDate("2000-2-29") + as.ddur("P1Y"), as.FDate(20010228L))
	expect_equal(as.FDate("2000-2-29") + as.ddur("P-1Y"), as.FDate(19990228L))

	expect_equal(as.FDate("2000-1-31") + as.ddur("P1M"), as.FDate("2000-2-31"))
	expect_equal(as.FDate("2000-1-31") + as.ddur("P1M1D"), as.FDate("2000-03-01"))
	expect_equal(as.FDate("2000-1-31") + as.ddur("P3M"), as.FDate("2000-04-30"))
	expect_equal(as.FDate("2000-1-31") + as.ddur("P3M2D"), as.FDate("2000-05-02"))
	expect_equal(as.FDate("2000-1-31") + as.ddur("P-2M"), as.FDate(19991130L))
	expect_equal(as.FDate("2000-1-31") + as.ddur("P-2M-1D"), as.FDate(19991130L))
	expect_equal(as.FDate("2000-1-31") + as.ddur("P1M-1D"), as.FDate(20000229L))
	expect_equal(as.FDate("2000-1-31") + as.ddur("P-2M1D"), as.FDate(19991201L))
	expect_true(is.na(as.FDate("2000-1-31") + as.ddur("XXX")))
})

test_that("ddur arith", {
	expect_equal(as.ddur("P0") + as.ddur("P2M"), as.ddur("P2M"))
	expect_equal(as.ddur("P2D") + as.ddur("P2M"), as.ddur("P2M2D"))
	expect_equal(as.ddur("P-1D") + as.ddur("P2M"), as.ddur("2M-1D"))
	expect_equal(as.ddur("P2D") - as.ddur("P2D"), ddur(0L))
	expect_equal(as.ddur("P2D") - as.ddur("P2M"), ddur("-2M2D"))
	expect_equal(-as.ddur("P-2M2D"), as.ddur("P2M-2D"))
	expect_true(is.na(as.ddur("AA") + as.ddur("P2M")))
	expect_true(is.na(as.ddur("TN") + as.ddur("XN")))
})

if (FALSE) {
print("")
print(as.FDate("2000-2-29") - as.FDate("2000-1-20"))
print(as.FDate("2000-2-29") - as.FDate("2001-1-20"))
print(as.FDate("2000-2-29") - as.FDate("2000-2-10"))
print(as.FDate("2000-2-10") - as.FDate("2000-2-29"))
print(as.FDate("2000-2-29") - as.FDate("2000-3-10"))
print(as.FDate("2000-3-10") - as.FDate("2000-2-29"))
print(as.FDate("2000-2-29") - as.FDate("2001-1-32"))
print(as.FDate(NA_character_) - as.FDate("2001-1-20"))

print("")
print(ddur(as.FDate("2000-2-29"),as.FDate("2000-3-10")))
print(ddur(as.FDate("2000-3-10"),as.FDate("2000-2-29")))
print(ddur(as.FDate(NA_character_), as.FDate("2001-1-20")))

print("")
print(as.FDate("2000-2-28") + as.ddur("P0"))
print(as.FDate("2000-2-28") + as.ddur("ON"))
print(as.FDate("2000-2-28") + as.ddur("P1W"))
print(as.FDate("2000-2-28") + as.ddur("-SN"))
print(as.FDate("2000-2-28") + as.ddur("P-2W"))

print("")
print(as.FDate("2000-1-31") + as.ddur("P1M"))
print(as.FDate("2000-1-31") + as.ddur("P1M1D"))
print(as.FDate("2000-1-31") + as.ddur("P3M"))
print(as.FDate("2000-1-31") + as.ddur("P3M2D"))
print(as.FDate("2000-1-31") + as.ddur("P-2M"))
print(as.FDate("2000-1-31") + as.ddur("P-2M-1D"))
print(as.FDate("2000-1-31") + as.ddur("P1M-1D"))
print(as.FDate("2000-1-31") + as.ddur("P-2M1D"))
print(as.FDate("2000-3-06") - as.ddur("P12D"))
print(as.FDate("2000-3-06") + as.ddur("P-42D"))

print("")
print(as.FDate("2000-A") + as.ddur("ON"))
print(as.FDate("2000-A") + as.ddur("P1M"))
print(as.FDate("2000-A") + as.ddur("P5Y"))
print(as.FDate("2000-A") - as.ddur("P5Y"))
print("")
print(as.FDate("2000-S1") + as.ddur("ON"))
print(as.FDate("2000-S1") + as.ddur("P1M"))
print(as.FDate("2000-S1") + as.ddur("P6M"))
print(as.FDate("2000-S1") + as.ddur("P6Y"))
print(as.FDate("2000-S2") + as.ddur("P6M"))
print(as.FDate("2000-S1") + as.ddur("P-6M"))
print(as.FDate("2000-S2") - as.ddur("P6M"))
print("")
print(as.FDate("2000-Q2") + as.ddur("ON"))
print(as.FDate("2000-Q2") + as.ddur("P1M"))
print(as.FDate("2000-Q2") + as.ddur("P6M"))
print(as.FDate("2000-Q2") + as.ddur("P9M"))
print(as.FDate("2000-Q2") - as.ddur("P9M"))
print(as.FDate("2000-Q2") + as.ddur("P-3M"))
print("")
print(as.FDate("2000-02") + as.ddur("ON"))
print(as.FDate("2000-02") + as.ddur("P1M"))
print(as.FDate("2000-02") + as.ddur("P1Y"))
print(as.FDate("2000-02") - as.ddur("P1M"))
print(as.FDate("2000-02") + as.ddur("P-1Y"))

print("FDate diff")
print(as.FDate("2000-3-22") - as.FDate("2000-03-12"))
print(as.FDate("2000-3-12") - as.FDate("2000-03-22"))
print(as.FDate("2000-3-22") - as.FDate("2000-02-12"))
print(as.FDate("2000-2-22") - as.FDate("2000-03-12"))
print(as.FDate("2000-3-30") - as.FDate("1999-12-01"))
print("")
print(as.FDate("2000-3") - as.FDate("1999-12"))
print(as.FDate("2000-Q3") - as.FDate("1999-Q4"))
print(as.FDate("2000-S1") - as.FDate("1999-S2"))
print(as.FDate("2000-A") - as.FDate("1999"))
print(as.FDate("2000-3") - as.FDate("1999-Q4"))
print(as.FDate("2000-Q3") - as.FDate("1999-S2"))
print(as.FDate("2000-S2") - as.FDate("1999"))
print("")
print(as.FDate("2000-3") - as.FDate("1999-12-12"))
print(as.FDate("2000-Q3") - as.FDate("2000-02-29"))
print(as.FDate("2000-S1") - as.FDate("1999-12-31"))
print(as.FDate("2000-A") - as.FDate("1999-11-31"))
print("")
print(ddur(as.FDate("1999-12-12"), as.FDate("2000-3")))
print(ddur(as.FDate("2000-02-29"), as.FDate("2000-Q3")))
print(ddur(as.FDate("2000-03-12"), as.FDate("2000-3-22")))
print(ddur(as.FDate("2000-03-22"), as.FDate("2000-3-12")))
print(ddur(as.FDate("2000-02-12"), as.FDate("2000-3-22")))
print(ddur(as.FDate("2000-03-12"), as.FDate("2000-2-22")))
print(ddur(as.FDate("1999-12-01"), as.FDate("2000-3-30")))
}
